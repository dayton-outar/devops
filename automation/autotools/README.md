# Autotools Cheat Sheet

This folder contains material from the Jupiter project source code repository for the No Starch Press book, Autotools, 2nd Edition.

The book covers the following key areas:

 1. Introduction to Autotools: An overview of the purpose and benefits of using the Autotools suite in software development projects.

 2. Autoconf: Detailed explanations of Autoconf, a tool responsible for generating configuration scripts that adapt software builds to various system environments and requirements.

 3. Automake: In-depth coverage of Automake, a tool that simplifies the process of writing Makefiles to manage project compilation and installation.

 4. Libtool: A thorough exploration of Libtool, a utility for managing shared libraries on different platforms and handling their versioning and linking.

 5. M4 Macro Language: An explanation of the M4 macro language, which is extensively used by the Autotools for defining templates and generating scripts.

 6. Best Practices: Guidance on best practices for using Autotools effectively, addressing common issues, and making projects more portable.

 7. Debugging and Troubleshooting: Strategies for debugging configuration and build issues that may arise while using Autotools.

 8. Case Studies: Real-world case studies demonstrating how to apply Autotools in various types of projects.

Autotools is a comprehensive guide to the GNU Autotools, a collection of tools used in Unix-based systems for building, configuring, and distributing software projects. The book would delve into various components of the Autotools suite, which includes Autoconf, Automake, Libtool, and related utilities.


## **Overview**
Autotools provides a framework for creating portable and flexible build systems. It typically consists of these key files:
- **configure.ac**: Input file for `autoconf`, specifies checks and options.
- **Makefile.am**: Input file for `automake`, specifies build targets.
- **config.h.in**: Template for configuration header, filled in by `autoheader`.

---

## **Workflow**

1. **Write Source Code**: Create the code that needs to be compiled and installed.
2. **Create Build Scripts**:
   - **Makefile.am**: Describes what needs to be built and installed.
   - **configure.ac**: Describes system checks, feature tests, etc.
3. **Generate Build System**:
   - **autoreconf -i**: Automatically runs `aclocal`, `autoheader`, `automake`, and `autoconf`.
4. **Run Configuration**:
   - **./configure**: Script generated by Autoconf to check system and configure the package.
5. **Build the Project**:
   - **make**: Builds the project.
6. **Install the Project**:
   - **make install**: Installs the project to the appropriate system directories.

---

## **Autoconf (configure.ac)**

Autoconf generates the **`configure`** script, which tests system features and sets up compilation parameters.

### **Syntax for `configure.ac`**:
```bash
AC_INIT([package-name], [version], [bug-report-email])
AM_INIT_AUTOMAKE

# Checks for programs
AC_PROG_CC          # Check for C compiler
AC_PROG_CXX         # Check for C++ compiler

# Checks for libraries
AC_CHECK_LIB([m], [cos])  # Checks for the math library

# Checks for headers
AC_CHECK_HEADERS([stdio.h math.h])

# Output files
AC_CONFIG_FILES([Makefile])
AC_OUTPUT
```

### **Common Macros**
- **`AC_INIT`**: Initialize the package information.
- **`AM_INIT_AUTOMAKE`**: Initialize Automake options.
- **`AC_PROG_CC`**: Check for a C compiler.
- **`AC_PROG_CXX`**: Check for a C++ compiler.
- **`AC_CHECK_LIB`**: Check for a library (e.g., `-lm`).
- **`AC_CHECK_HEADERS`**: Check for system headers.
- **`AC_CONFIG_FILES`**: Specify files to be generated by `configure`.
- **`AC_OUTPUT`**: Generates the output files, typically `Makefile` and `config.h`.

---

## **Automake (Makefile.am)**

Automake generates **Makefile.in** from **Makefile.am**, which is processed by Autoconf to create a final **Makefile**.

### **Simple Example for `Makefile.am`**:
```makefile
bin_PROGRAMS = myapp            # Programs to be built
myapp_SOURCES = main.c util.c   # Source files for the program

# Data to install
pkgdata_DATA = README.md        # Files to be installed as data

# Header files to install
include_HEADERS = myheader.h    # Header files to install

# Custom commands for cleaning up
EXTRA_DIST = README.md INSTALL  # Extra files to distribute
```

### **Key Variables**
- **bin_PROGRAMS**: Executables to be built and installed in `$(bindir)`.
- **lib_LIBRARIES**: Libraries to be built.
- **myapp_SOURCES**: List of source files for a particular target (e.g., `myapp`).
- **include_HEADERS**: Header files to be installed.
- **pkgdata_DATA**: Data files to be installed.
- **EXTRA_DIST**: Extra files to be included in the distribution archive.
  
---

## **Automake Directives**
- **`AUTOMAKE_OPTIONS`**: Used in `Makefile.am` to specify options for Automake (e.g., `foreign` to allow non-GNU standards).
- **`SUBDIRS`**: Used to specify directories for recursive builds.
  
---

## **Common Automake Commands**
- **`automake --add-missing`**: Add missing files to the project (e.g., `INSTALL` or `COPYING`).
- **`automake`**: Generates `Makefile.in` from `Makefile.am`.

---

## **Libtool**

Libtool helps manage shared libraries across platforms.

### **Libtool in `configure.ac`**:
```bash
AC_PROG_LIBTOOL
```

### **Libtool in `Makefile.am`**:
```makefile
lib_LTLIBRARIES = libmylib.la   # A libtool library
libmylib_la_SOURCES = mylib.c   # Source files for the library
```

### **Common Commands**
- **`lib_LTLIBRARIES`**: List of libraries to be built.
- **`libmylib_la_SOURCES`**: Source files for the library `libmylib.la`.

---

## **Autoheader**

Autoheader creates a template header file (`config.h.in`) based on the checks defined in **`configure.ac`**.

### Example:
- In `configure.ac`:
  ```bash
  AC_CONFIG_HEADERS([config.h])
  ```

- Then, run:
  ```bash
  autoheader
  ```
  
  This creates `config.h.in`, a template file that defines macros for the detected system features.

---

## **Other Useful Commands**

- **`aclocal`**: Generates the `aclocal.m4` file with macros for Autoconf.
- **`autoconf`**: Creates the `configure` script from `configure.ac`.
- **`autoheader`**: Creates a template header file (`config.h.in`) from `configure.ac`.
- **`autoreconf -i`**: Automatically runs the full sequence of tools (`autoconf`, `automake`, etc.).
- **`automake`**: Generates `Makefile.in` from `Makefile.am`.

---

## **Building and Installation Commands**

- **`./configure`**: Runs the generated `configure` script to set up the project for the local system.
- **`make`**: Builds the project using the generated `Makefile`.
- **`make install`**: Installs the built program to system directories.
- **`make clean`**: Cleans up intermediate files created by the build.
- **`make dist`**: Creates a distribution tarball for the project.

---

This cheat sheet covers the fundamental concepts and commands in **Autotools**. With `configure.ac` and `Makefile.am`, Autotools generates portable build systems suitable for many Unix-like environments.

## Videos

1. [How to use autotools (automake, autoconf, aclocal, autoheader)](https://youtu.be/3XO0d9Qyc34?si=sLgmEegcxB_NZg30)